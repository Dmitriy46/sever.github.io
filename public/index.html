<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏—Å–ø–µ—Ç—á–µ—Ä –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ–∫</title>
    <style>
        /* –°—Ç–∏–ª–∏ –ª—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π CSS-—Ñ–∞–π–ª, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ—Å—Ç–∞–≤–∏–º –∑–¥–µ—Å—å */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; background-color: #f0f2f5; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        h1 { margin: 0; font-size: 24px; }
        .controls { background: white; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        select, input, button { font-size: 16px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin: 5px; }
        button { background-color: #667eea; color: white; border: none; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #5a67d8; }
        button.danger { background-color: #f56565; }
        button.danger:hover { background-color: #e53e3e; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; }
        td[contenteditable="true"] { background-color: #fff; }
        td[contenteditable="true"]:focus { outline: 2px solid #667eea; }
        .status { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); padding: 10px 20px; border-radius: 20px; color: white; z-index: 101; opacity: 0; transition: opacity 0.5s; }
        .status.show { opacity: 1; }
        .status.success { background-color: #48bb78; }
        .status.error { background-color: #f56565; }
    </style>
</head>
<body>

    <div class="header">
        <h1>üìã –î–∏—Å–ø–µ—Ç—á–µ—Ä –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ–∫</h1>
    </div>

    <div class="controls">
        <select id="sheetSelector" onchange="loadSheetData()">
            <option>–ó–∞–≥—Ä—É–∑–∫–∞...</option>
        </select>
        <button onclick="saveData()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button onclick="addRow()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
        <button onclick="sendData()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</button>
        <hr>
        <input type="text" id="newSheetName" placeholder="–ò–º—è –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞">
        <button onclick="createNewSheet()">–°–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç</button>
        <input type="text" id="renameSheetName" placeholder="–ù–æ–≤–æ–µ –∏–º—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ">
        <button onclick="renameSheet()">‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
        <button onclick="deleteSheet()" class="danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ª–∏—Å—Ç</button>
    </div>

    <div id="status" class="status"></div>

    <table id="dataTable">
        <thead>
            <tr>
                <th>–ú–∞—à–∏–Ω–∞</th>
                <th>–ì—Ä—É–∑</th>
                <th>–û—Ç–∫—É–¥–∞</th>
                <th>–ö—É–¥–∞</th>
                <th>–ó–∞–∫–∞–∑—á–∏–∫</th>
                <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

<script>
    // URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ï—Å–ª–∏ HTML –∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ –æ–¥–Ω–æ–º –¥–æ–º–µ–Ω–µ, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ('')
    // –ï—Å–ª–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ GitHub Pages, –∞ –±—ç–∫–µ–Ω–¥ –Ω–∞ Render),
    // —Ç–æ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π URL –±—ç–∫–µ–Ω–¥–∞.
    const API_BASE_URL = ''; // –ù–∞–ø—Ä–∏–º–µ—Ä: 'https://sever-github-io.onrender.com'
    let currentSheetName = '';

    // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ---
    function showStatus(message, type = 'success', duration = 3000) {
        const statusEl = document.getElementById('status');
        statusEl.textContent = message;
        statusEl.className = `status ${type} show`;
        setTimeout(() => {
            statusEl.classList.remove('show');
        }, duration);
    }

    // --- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API ---

    // 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ (–∑–∞–º–µ–Ω–∞ getSheetNames)
    async function loadSheetList() {
        try {
            const response = await fetch(`${API_BASE_URL}/sheets`);
            if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª–∏—Å—Ç–æ–≤');
            const sheets = await response.json();

            const selector = document.getElementById('sheetSelector');
            selector.innerHTML = sheets.map(name => `<option value="${name}">${name}</option>`).join('');

            if (sheets.length > 0) {
                currentSheetName = sheets[0];
                selector.value = currentSheetName;
                await loadSheetData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∞
            } else {
                 document.querySelector('#dataTable tbody').innerHTML = '<tr><td colspan="6">–õ–∏—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π.</td></tr>';
            }
        } catch (error) {
            showStatus(error.message, 'error');
        }
    }

    // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ (–∑–∞–º–µ–Ω–∞ getSheetData)
    async function loadSheetData() {
        currentSheetName = document.getElementById('sheetSelector').value;
        if (!currentSheetName) return;

        try {
            const response = await fetch(`${API_BASE_URL}/sheets/${encodeURIComponent(currentSheetName)}`);
            if (!response.ok) throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ª–∏—Å—Ç–∞ "${currentSheetName}"`);

            const data = await response.json();
            updateTable(data);
            showStatus(`–õ–∏—Å—Ç "${currentSheetName}" –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
        } catch (error) {
            showStatus(error.message, 'error');
        }
    }

    // 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∞ saveToSheet)
    async function saveData() {
        if (!currentSheetName) return showStatus('–õ–∏—Å—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');

        const rows = Array.from(document.querySelectorAll('#dataTable tbody tr'));
        const dataToSave = rows.map(row =>
            Array.from(row.cells).map(cell => cell.textContent.trim())
        );

        try {
            const response = await fetch(`${API_BASE_URL}/sheets/${encodeURIComponent(currentSheetName)}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSave),
            });

            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
            showStatus('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
        } catch (error) {
            showStatus(error.message, 'error');
        }
    }

    // 4. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞ (–∑–∞–º–µ–Ω–∞ addNewSheet)
    async function createNewSheet() {
        const nameInput = document.getElementById('newSheetName');
        const name = nameInput.value.trim();
        if (!name) return showStatus('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞', 'error');

        try {
            const response = await fetch(`${API_BASE_URL}/sheets`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name }),
            });

            const result = await response.json();
            if (!response.ok) throw new Error(result.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏—Å—Ç–∞');
            
            nameInput.value = '';
            showStatus(`–õ–∏—Å—Ç "${name}" —Å–æ–∑–¥–∞–Ω`, 'success');
            await loadSheetList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ª–∏—Å—Ç–æ–≤
            document.getElementById('sheetSelector').value = name; // –í—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–π –ª–∏—Å—Ç
        } catch (error) {
            showStatus(error.message, 'error');
        }
    }

    // 5. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ (–∑–∞–º–µ–Ω–∞ renameSheet)
    async function renameSheet() {
        const newNameInput = document.getElementById('renameSheetName');
        const newName = newNameInput.value.trim();
        if (!newName) return showStatus('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –¥–ª—è –ª–∏—Å—Ç–∞', 'error');
        if (!currentSheetName) return showStatus('–¢–µ–∫—É—â–∏–π –ª–∏—Å—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');

        try {
            const response = await fetch(`${API_BASE_URL}/sheets/${encodeURIComponent(currentSheetName)}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ newName: newName }),
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error || '–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è');

            newNameInput.value = '';
            showStatus('–õ–∏—Å—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω', 'success');
            await loadSheetList();
            document.getElementById('sheetSelector').value = newName;
        } catch (error) {
            showStatus(error.message, 'error');
        }
    }

    // 6. –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—Å—Ç–∞ (–∑–∞–º–µ–Ω–∞ deleteSheet)
    async function deleteSheet() {
        if (!currentSheetName) return showStatus('–õ–∏—Å—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
        if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ª–∏—Å—Ç "${currentSheetName}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.`)) return;

        try {
             const response = await fetch(`${API_BASE_URL}/sheets/${encodeURIComponent(currentSheetName)}`, {
                method: 'DELETE',
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            
            showStatus(`–õ–∏—Å—Ç "${currentSheetName}" —É–¥–∞–ª–µ–Ω`, 'success');
            await loadSheetList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π
        } catch (error) {
            showStatus(error.message, 'error');
        }
    }
    
    // 7. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram (–∑–∞–º–µ–Ω–∞ sendToTelegram)
    async function sendData() {
        const rows = Array.from(document.querySelectorAll('#dataTable tbody tr'));
        const message = rows.map((row, i) => {
            const cells = Array.from(row.cells).map(c => c.textContent.trim());
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
            if (cells.every(c => c === '')) return null; 
            return `${i + 1}. üöõ *–ú–∞—à–∏–Ω–∞*: ${cells[0] || '-'}\n` +
                   `üì¶ *–ì—Ä—É–∑*: ${cells[1] || '-'}\n` +
                   `üìç *–ú–∞—Ä—à—Ä—É—Ç*: ${cells[2] || '?'} ‚Üí ${cells[3] || '?'}\n` +
                   `üë§ *–ó–∞–∫–∞–∑—á–∏–∫*: ${cells[4] || '-'}\n` +
                   `üìù *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ*: ${cells[5] || '-'}`;
        }).filter(Boolean).join('\n\n');

        if (!message) return showStatus('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');

        try {
             const response = await fetch(`${API_BASE_URL}/send-to-telegram`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: `üìÖ ${currentSheetName}\n\n${message}` }),
            });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram');

            showStatus('–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!', 'success');
        } catch (error) {
            showStatus(error.message, 'error');
        }
    }


    // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—á—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
    function updateTable(data) {
        const tbody = document.querySelector('#dataTable tbody');
        tbody.innerHTML = '';
        if (!data || data.length === 0) {
            addRow(); // –î–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
            return;
        }
        data.forEach(rowData => {
            const tr = tbody.insertRow();
            for (let i = 0; i < 6; i++) {
                const td = tr.insertCell();
                td.textContent = rowData[i] || '';
                td.contentEditable = true;
            }
        });
    }

    function addRow() {
        const tbody = document.querySelector('#dataTable tbody');
        const tr = tbody.insertRow();
        for (let i = 0; i < 6; i++) {
            const td = tr.insertCell();
            td.contentEditable = true;
        }
        tr.cells[0].focus(); // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–π —è—á–µ–π–∫–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    }

    // --- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
    document.addEventListener('DOMContentLoaded', loadSheetList);

</script>
</body>
</html>